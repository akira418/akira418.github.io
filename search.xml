<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[How to install the redash in the Offline Environment]]></title>
    <url>%2F2018%2F08%2F19%2FHow-to-install-the-redash-in-the-Offline-Environment%2F</url>
    <content type="text"><![CDATA[前言Zabbix监控运维中，积累了很多的基础数据。 结合 Grafana，可以非常棒的展现出时序的一些情况。但是设计到一些静态的报表时，Grafana存在一定的限制。 开源的BI工具有很多，这里采用了 Redash，进行报表的展示。 Redash的介绍如下： 【Redash is an open source tool for teams to query, visualize and collaborate. Redash is quick to setup and works with any data source you might need so you can query from anywhere in no time. 】 环境版本安装环境版本如下： CentOS Linux release 7.5.1804 (Core)redash 5.0.0Python 2.7postgresql &gt;= 9.3Redis &gt;= 2.8.3Node.js &gt;= v6 Note： 所有的安装包都需要通过一台联网的服务器下载后，导入到内网；文中：联网服务器操作采用 【Online】表示，离线服务器操作采用【Offline】表示； 操作步骤下载安装中需要的RPM包123456789101112131415161718192021【Online】# 下载包到/tmp/packages内yum install --downloadonly --downloaddir=/tmp/packages gcc gcc-c++ cyrus-sasl-devel make yum install --downloadonly --downloaddir=/tmp/packages pwgen python-devel python-pip supervisoryum install --downloadonly --downloaddir=/tmp/packages nginx curl wget redis yum install --downloadonly --downloaddir=/tmp/packages libffi-devel mariadb-develyum install --downloadonly --downloaddir=/tmp/packages libffi-devel mariadb-develyum install --downloadonly --downloaddir=/tmp/packages freetds-develyum install --downloadonly --downloaddir=/tmp/packages nodejs unzip【Offline】# 将下载的RPM包上传到服务器内yum install -y gcc gcc-c++ cyrus-sasl-devel make yum install -y pwgen python-devel python-pip supervisoryum install -y nginx curl wget redis yum install -y libffi-devel mariadb-develyum install -y freetds-develyum install -y nodejs unzip 下载 postgresql 9.5 注意下载的版本，需要单独加载postgresql的yum环境 12345678【Online】yum install https://download.postgresql.org/pub/repos/yum/9.5/redhat/rhel-7-x86_64/pgdg-centos95-9.5-3.noarch.rpmyum install --downloadonly --downloaddir=/tmp/packages libpqxx-develyum install --downloadonly --downloaddir=/tmp/packages postgresql95-server postgresql95-contrib【Offline】yum install -y libpqxx-develyum install -y postgresql95-server postgresql95-contrib 设置 postgresql1234567891011121314151617181920212223242526272829303132333435【Offline】# 初始化 postgresql 数据库/usr/pgsql-9.5/bin/postgresql95-setup initdb# 设置服务systemctl enable postgresql-9.5.servicesystemctl start postgresql-9.5.servicesystemctl status postgresql-9.5.service# 查看数据库版本psql --version# 设置密码su - postgrespsql -U postgresALTER USER postgres WITH PASSWORD '123456'\q# 设置远程访问vi /var/lib/pgsql/9.5/data/postgresql.conf修改#listen_addresses = 'localhost' 为 listen_addresses='*'# 设置信任的远程连接vi /var/lib/pgsql/9.5/data/pg_hba.conf # IPv4 local connections: host all all 127.0.0.1/32 ident host all all 0.0.0.0/0 trust# 重启服务systemctl restart postgresql-9.5.service# 设置postgresql的环境变量vim /root/.bash_profileexport PATH="/usr/pgsql-9.5/bin:$PATH" 启动redis123456789【Offline】# 启动redis服务systemctl start redissystemctl enable redissystemctl status redis# 检查redis是否能正常运行redis-cli 目录和账号创建123456【Offline】# 添加账号，并创建目录mkdir -p /opt/redashadduser --system --no-create-home -s /sbin/nologin redashchown redash /opt/redash 下载 Redash 的安装包1234567891011121314【Online】sudo wget https://codeload.github.com/getredash/redash/zip/master【Offline】cd /opt/redash# 下载最新的redash安装包，并上传到离线环境 /opt/redash 内sudo chown redash redash-master.zipsudo -u redash unzip redash-master.zipln -nfs /opt/redash/redash-3.0.0 /opt/redash/current 环境配置1234567891011【Offline】pwgen -1s 32获取值，用于REDASH_COOKIE_SECRET vim /opt/redash/.envexport REDASH_LOG_LEVEL="INFO"export REDASH_REDIS_URL=redis://localhost:6379/0export REDASH_DATABASE_URL="postgresql:///redash"export REDASH_COOKIE_SECRET=xQ11GIKUXtaMKAyf6OESnssU2zczpy27 ln -nfs /opt/redash/.env /opt/redash/current/.env Pip安装123456789101112131415161718192021222324【Online】# 配置阿里云的pip库vi /root/.pip/pip.conf[global]timeout = 6000index-url = http://mirrors.aliyun.com/pypi/simple[install]trusted-host=mirrors.aliyun.com# 下载需要安装的离线安装包pip download -r requirements.txt -r requirements_dev.txt -r requirements_all_ds.txt -d /tmp/pip【Offline】# 上传离线下载的安装包到 /pip 目录内cd /opt/redash/currentpip install --no-index -f /pip psycopg2pip install --no-index -f /pip -r requirements.txt -r requirements_dev.txt -r requirements_all_ds.txt NPM 安装12345678910【Online】curl --silent --location https://rpm.nodesource.com/setup_6.x | bash -yum install -y nodejsnpm install -g cnpm --registry=https://registry.npm.taobao.orgcnpm installcnpm run build【Offline】上传NPM下载的包到 /opt/redash/current/node_modules 内。 创建数据库123sudo -u postgres createuser redash --no-superuser --no-createdb --no-createrolesudo -u postgres createdb redash --owner=redashsudo -u redash bin/run ./manage.py database create_tables supervisord配置12cp /opt/redash/current/setup/ubuntu/files/supervisord.conf /etc/supervisord.d/redash.inisystemctl start supervisord Nginx配置1234cp /opt/redash/current/setup/ubuntu/files/nginx_redash_site /etc/nginx/conf.d/nginx_redash_site.conf修改/etc/nginx/conf.d/nginx_redash_site.conf中端口为8080页面访问 http://ip:8080 参考链接 https://www.cnblogs.com/shhnwangjian/p/8417748.html https://redash.io/help/open-source/setup Changelog 日期 修改内容 20180819 初稿 20180819 修改格式]]></content>
      <tags>
        <tag>Redash</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Centos 7 更新 NVIDIA 驱动]]></title>
    <url>%2F2018%2F06%2F02%2FCentos-7-%E6%9B%B4%E6%96%B0-NVIDIA-%E9%A9%B1%E5%8A%A8%2F</url>
    <content type="text"><![CDATA[系统版本CentOS Linux release 7.5.1804 (Core) Linux localhost.localdomain 3.10.0-862.3.2.el7.x86_64 问题描述台式机安装了Centos，在启动的时候直接黑屏，然后没法直接进图形化界面。 报了如下报错： nouveau 0000:01:00:0: secboot : error during falcon reset : -110 nouveau 0000:01:00:0: gr : init failed, -110 检查了下当前的设备： [root@localhost ~]# lspci | grep -i vga 01:00.0 VGA compatible controller: NVIDIA Corporation GP106 [GeForce GTX 1060 6GB] (rev a1) [root@localhost ~]# lspci ... 01:00.1 Audio device: NVIDIA Corporation GP106 High Definition Audio Controller (rev a1) Subsystem: Micro-Star International Co., Ltd. [MSI] Device 8c94 Flags: bus master, fast devsel, latency 0, IRQ 17 Memory at f7080000 (32-bit, non-prefetchable) [size=16K] Capabilities: [60] Power Management version 3 Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [78] Express Endpoint, MSI 00 Capabilities: [100] Advanced Error Reporting Kernel driver in use: snd_hda_intel Kernel modules: snd_hda_intel ... 升级步骤：1.下载对应的驱动： 登录网站： https://www.nvidia.cn/Download/index.aspx?lang=cn 2.加载EPEL源，安装DKMS：yum -y install epel-release yum -y install dkms 3. 升级和安装需要的包：yum -y update yum -y install kernel-devel yum -y groupinstall &quot;GNOME Desktop&quot; &quot;Development Tools&quot; 4. 修改grub文件：在/etc/default/grub,修改如下行 GRUB_CMDLINE_LINUX=&quot;crashkernel=auto rhgb quiet rd.driver.blacklist=nouveau nouveau.modeset=0&quot; grub2-mkconfig -o /boot/grub2/grub.cfg 注释nouveau模块 在/etc/modprobe.d/blacklist.conf文件内，添加以下内容： blacklist nouveau 备份旧的initramfs，并且创建新的initramfs mv /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r)-nouveau.img dracut /boot/initramfs-$(uname -r).img $(uname -r) 5. 修改启动项：需要将启动项目修改为init3 systemctl isolate multi-user.target 6. 重启系统：reboot 7. 安装驱动：sh NVIDIA-Linux-x86_64-*.run 安装完成后，重启系统 设置启动后为图形化界面： systemctl set-default graphical.target 大功告成~ 参考链接：http://www.advancedclustering.com/act_kb/installing-nvidia-drivers-rhel-centos-7/]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
</search>
